<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Editor - Ancestrio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  <link rel="stylesheet" href="../styles/theme.css" />
  <link rel="stylesheet" href="../styles/base.css" />
  <link rel="stylesheet" href="../styles/components.css" />
  <link rel="stylesheet" href="../styles/page-overrides.css" />
  <link rel="stylesheet" href="../styles/page-common.css" />
  <link rel="stylesheet" href="../styles/editor.css" />
</head>
<body class="editor-page">
  <header class="topbar app-header">
    <div class="brand-group">
      <button id="themeBtn" title="Switch theme" aria-label="Switch theme">
        <span class="material-symbols-outlined" aria-hidden="true">light_mode</span>
      </button>
      <div class="brand" id="treeTitle">Loading...</div>
    </div>
    <div class="controls controls-editor">
      <button id="saveBtn" title="Save changes" aria-label="Save changes" disabled>
        <span class="material-symbols-outlined" aria-hidden="true">save</span>
        Save
      </button>
      <button id="viewTreeBtn" title="Preview tree" aria-label="Preview tree">
        <span class="material-symbols-outlined" aria-hidden="true">visibility</span>
        Preview
      </button>
      <button id="dashboardBtn" type="button" class="dashboard-link" title="Back to Dashboard" aria-label="Back to dashboard">
        <span class="material-symbols-outlined" aria-hidden="true">arrow_back</span>
        Dashboard
      </button>
    </div>
  </header>

  <main class="editor-main">
    <div class="editor-container">
      <div class="editor-layout">
        <div class="editor-sidebar">
          <div class="sidebar-section">
            <h3>
              <span class="material-symbols-outlined">settings</span>
              Tree Settings
            </h3>
            <div class="form-group">
              <label class="form-label">Tree Name</label>
              <input type="text" id="editTreeName" class="form-input" />
            </div>
            <div class="form-group">
              <label class="form-label">Description</label>
              <textarea id="editTreeDescription" class="form-input" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">Privacy</label>
              <select id="editTreePrivacy" class="form-input">
                <option value="private">Private</option>
                <option value="public">Public</option>
              </select>
            </div>
          </div>

          <div class="sidebar-section">
            <h3>
              <span class="material-symbols-outlined">bolt</span>
              Quick Actions
            </h3>
            <button class="action-btn" id="addPersonBtn">
              <span class="material-symbols-outlined">person_add</span>
              Add Family Member
            </button>
            <button class="action-btn" id="importJsonBtn">
              <span class="material-symbols-outlined">upload_file</span>
              Import JSON
            </button>
            <button class="action-btn" id="exportJsonBtn">
              <span class="material-symbols-outlined">download</span>
              Export JSON
            </button>
          </div>

          <div class="sidebar-section">
            <h3>
              <span class="material-symbols-outlined">help</span>
              Instructions
            </h3>
            <ul class="instructions-list">
              <li>Click on any person to edit their details</li>
              <li>Use the JSON editor below for advanced editing</li>
              <li>Changes are saved to the cloud</li>
              <li>Preview your tree before publishing</li>
            </ul>
          </div>
        </div>

        <div class="editor-content">
          <div class="editor-tabs">
            <button class="editor-tab active" data-tab="visual">
              <span class="material-symbols-outlined">account_tree</span>
              Visual Editor
            </button>
            <button class="editor-tab" data-tab="json">
              <span class="material-symbols-outlined">code</span>
              JSON Editor
            </button>
          </div>

          <div class="tab-content active" id="visualTab">
            <div class="visual-editor">
              <div class="visual-toolbar">
                <div class="visual-toolbar-group">
                  <button class="tool-btn" id="visualZoomIn" type="button" aria-label="Zoom in">
                    <span class="material-symbols-outlined">add</span>
                    Zoom In
                  </button>
                  <button class="tool-btn" id="visualZoomOut" type="button" aria-label="Zoom out">
                    <span class="material-symbols-outlined">remove</span>
                    Zoom Out
                  </button>
                  <button class="tool-btn" id="visualReset" type="button" aria-label="Reset view">
                    <span class="material-symbols-outlined">center_focus_strong</span>
                    Reset
                  </button>
                </div>
                <div class="visual-toolbar-hint" id="visualHint">Click + on a member to add Parent, Spouse, or Child.</div>
              </div>
              <div class="visual-canvas" id="visualCanvas">
                <svg id="visualTree" tabindex="0" aria-label="Family tree editor canvas" role="img"></svg>
              </div>
            </div>
          </div>

          <div class="tab-content" id="jsonTab">
            <div class="json-editor-wrapper">
              <div class="json-toolbar">
                <button id="formatJsonBtn" class="tool-btn">
                  <span class="material-symbols-outlined">format_align_left</span>
                  Format
                </button>
                <button id="validateJsonBtn" class="tool-btn">
                  <span class="material-symbols-outlined">check_circle</span>
                  Validate
                </button>
                <span class="json-status" id="jsonStatus"></span>
              </div>
              <textarea id="jsonEditor" class="json-editor" spellcheck="false"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Import JSON Modal -->
  <div id="importModal" class="modal" style="display: none;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Import JSON</h3>
          <button class="modal-close" id="closeImportModal">&times;</button>
        </div>
        <div class="modal-body">
          <p>Upload a JSON file or paste your family tree data:</p>
          <input type="file" id="fileInput" accept=".json" class="file-input" />
          <div class="divider-text">or</div>
          <textarea id="pasteJson" class="form-input" rows="10" placeholder='{"Grandparent": "...", ...}'></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" id="cancelImportBtn">Cancel</button>
          <button type="button" class="btn-primary" id="confirmImportBtn">Import</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteConfirmModal" class="modal" style="display: none;">
    <div class="modal-dialog modal-small">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Delete Person</h3>
          <button class="modal-close" id="closeDeleteModal">&times;</button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this person? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" id="cancelDeleteBtn">Cancel</button>
          <button type="button" class="btn-danger" id="confirmDeleteBtn">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Member Popup Menu -->
  <div id="addMemberPopup" class="add-member-popup" role="menu" aria-label="Add family relation">
    <button class="add-member-popup-item add-member-popup-parent" data-relation="parent" type="button" aria-label="Add parent" title="Add parent">
      <span class="material-symbols-outlined" aria-hidden="true">supervisor_account</span>
      <span class="add-member-popup-label">Parent</span>
    </button>
    <button class="add-member-popup-item add-member-popup-spouse" data-relation="spouse" type="button" aria-label="Add spouse" title="Add spouse">
      <span class="material-symbols-outlined" aria-hidden="true">favorite</span>
      <span class="add-member-popup-label">Spouse</span>
    </button>
    <button class="add-member-popup-item add-member-popup-child" data-relation="child" type="button" aria-label="Add child" title="Add child">
      <span class="material-symbols-outlined" aria-hidden="true">child_care</span>
      <span class="add-member-popup-label">Child</span>
    </button>
  </div>

  <!-- Add Member Modal Form -->
  <div id="addMemberModal" class="add-member-modal">
    <div class="add-member-card">
      <div class="add-member-header">
        <h3>
          <span class="material-symbols-outlined">person_add</span>
          <span id="addMemberTitle">Add Family Member</span>
        </h3>
        <button class="modal-close" id="closeAddMemberModal">&times;</button>
      </div>
      <div class="add-member-body">
        <!-- Photo Upload -->
        <div class="photo-upload-section">
          <div class="photo-upload-preview" id="photoUploadPreview">
            <span class="material-symbols-outlined">add_a_photo</span>
            <img id="photoPreviewImg" src="" alt="" style="display: none;">
          </div>
          <input type="file" id="memberPhotoInput" accept="image/*" style="display: none;">
          <span class="photo-upload-hint">Click to upload photo</span>
        </div>

        <!-- Required Fields -->
        <div class="required-fields">
          <div class="field-row">
            <div class="field-group">
              <label class="field-label">First Name <span class="required">*</span></label>
              <input type="text" id="memberFirstName" class="field-input" placeholder="John">
            </div>
            <div class="field-group">
              <label class="field-label">Last Name <span class="required">*</span></label>
              <input type="text" id="memberLastName" class="field-input" placeholder="Doe">
            </div>
          </div>
          <div class="field-group full-width">
            <label class="field-label">Birthday</label>
            <input type="text" id="memberBirthday" class="field-input" placeholder="30/12/1923">
          </div>
        </div>

        <!-- Countries Visited -->
        <div class="countries-section">
          <label class="field-label">Countries Visited</label>
          <div id="visitedCountriesList" class="person-list"></div>
          <button type="button" class="btn-secondary btn-inline" id="addVisitedCountryBtn">Add country</button>
        </div>
      </div>
      <div class="add-member-footer">
        <button type="button" class="btn-secondary" id="cancelAddMember">Cancel</button>
        <button type="button" class="btn-primary" id="confirmAddMember">Add Member</button>
      </div>
    </div>
  </div>


  <!-- Firebase SDK -->
  <script src="../scripts/runtime.js"></script>
  <script src="../scripts/night-sky.js"></script>
  <script src="../scripts/day-clouds.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="../scripts/theme-toggle.js"></script>
  <script src="../scripts/dom-display.js"></script>
  <script src="../scripts/firebase-config.js?v=5"></script>
  <script src="../scripts/editor.js?v=3"></script>
</body>
</html>

